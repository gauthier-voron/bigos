#!/bin/sh
# Run cg on a native Linux with all machine resources.

error() {
    MSG=$1; shift
    echo "$0: $MSG" 1>&2
    exit 1
}

RESULTS=cg-interl.`date +'%Y-%m-%d-%H-%M-%S'`

mkdir "$RESULTS" || error "cannot mkdir '$RESULTS'"
mkdir "$RESULTS/log" || error "cannot mkdir '$RESULTS/logs'"
build-cg "$RESULTS/npb" || exit 1

cd "$RESULTS"
perf stat -a -o log/perf.log -e ra8e9,r98e9 numactl --interleave=all cg npb

mv `find npb/ -name "*.log"` log

mv log/* .
rm -rf npb
rmdir log

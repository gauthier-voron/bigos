#!/usr/bin/perl -wl
use strict;

my $NAME = shift;
my @EVTS = @ARGV;
my $pid;

@EVTS || exit 1;

# Prepare the log and pid files
open STDOUT, '>', "$NAME.log" || exit 1;

open $pid, '>', "$NAME.pid" || exit 1;
print $pid $$;
close $pid;

# Do the measure
unshift @EVTS, 'xenperf';

open STDERR, '>', "/dev/null" || exit 1;    # Hide stderr informations
$| = 1;                                     # Enable autoflush for STDOUT
$SIG{QUIT} = sub { kill 'INT', $$ };
$SIG{TERM} = sub { kill 'INT', $$ };
exec @EVTS;
